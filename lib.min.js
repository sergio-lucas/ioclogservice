var ioc=function(){"use strict";var t,e=".",r="function",i="string",n="__global__",o="Provider",s=0,a=Array.prototype.slice,c=function(e,r){var i=e[r];if(void 0===i&&t.config.strict)throw new Error("Bottle was unable to resolve a service.  `"+r+"` is undefined.");return i},l=function(e){var r;return this.nested[e]||(r=t.pop(),this.nested[e]=r,this.factory(e,(function(){return r.container}))),this.nested[e]},u=function(t){return t.split(e).reduce(c,this)},h=function(t,e){return e(t)},d=function(t,e){return(t[e]||[]).concat(t.__global__||[])},f=function(t,e){var r,i,n,s,a;return this.id,n=this.container,s=this.decorators,a=this.middlewares,r=t+o,(i=Object.create(null))[r]={configurable:!0,enumerable:!0,get:function(){var t=new e;return delete n[r],n[r]=t,t}},i[t]={configurable:!0,enumerable:!0,get:function(){var e,i=n[r];return i&&(e=d(s,t).reduce(h,i.$get(n)),delete n[r],delete n[t]),void 0===e?e:function(t,e,r,i){var n={configurable:!0,enumerable:!0};return t.length?n.get=function(){var e=0,i=function(n){if(n)throw n;t[e]&&t[e++](r,i)};return i(),r}:(n.value=r,n.writable=!0),Object.defineProperty(i,e,n),i[e]}(d(a,t),t,e,n)}},Object.defineProperties(n,i),this},p=function(t,r){var i,n;return i=t.split(e),this.providerMap[t]&&1===i.length&&!this.container[t+o]?console.error(t+" provider already instantiated."):(this.originalProviders[t]=r,this.providerMap[t]=!0,n=i.shift(),i.length?(l.call(this,n).provider(i.join(e),r),this):f.call(this,n,r))},v=function(t,e){return p.call(this,t,(function(){this.$get=e}))},g=function(t,e,r){var i=arguments.length>3?a.call(arguments,3):[],n=this;return v.call(this,t,(function(){var t=e,o=i.map(u,n.container);return r?new(e.bind.apply(e,[null].concat(o))):t.apply(null,o)}))},y=function(t,e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})},b=function(t,e){var r=t[e];return r||y.call(t,e,r={}),r},m=function(t,e){Object.defineProperty(this,t,{configurable:!1,enumerable:!0,value:e,writable:!1})},w=function(t,i){var o,s;return typeof t===r&&(i=t,t=n),s=(o=t.split(e)).shift(),o.length?l.call(this,s).decorator(o.join(e),i):(this.decorators[s]||(this.decorators[s]=[]),this.decorators[s].push(i)),this},j=function(t){return!/^\$(?:decorator|register|list)$|Provider$/.test(t)},P=function(t){return Object.keys(t||this.container||{}).filter(j)},$={},O=function(t){var e=void 0===t.$value?t:t.$value;return this[t.$type||"service"].apply(this,[t.$name,e].concat(t.$inject||[]))},_=function(t){delete this.providerMap[t],delete this.container[t],delete this.container[t+o]};(t=function t(e){if(!(this instanceof t))return t.pop(e);this.id=s++,this.decorators={},this.middlewares={},this.nested={},this.providerMap={},this.originalProviders={},this.deferred=[],this.container={$decorator:w.bind(this),$register:O.bind(this),$list:P.bind(this)}}).prototype={constant:function(t,r){var i=t.split(e);return t=i.pop(),m.call(i.reduce(b,this.container),t,r),this},decorator:w,defer:function(t){return this.deferred.push(t),this},digest:function(t){return(t||[]).map(u,this.container)},factory:v,instanceFactory:function(t,e){return v.call(this,t,(function(t){return{instance:e.bind(e,t)}}))},list:P,middleware:function(t,i){var o,s;return typeof t===r&&(i=t,t=n),s=(o=t.split(e)).shift(),o.length?l.call(this,s).middleware(o.join(e),i):(this.middlewares[s]||(this.middlewares[s]=[]),this.middlewares[s].push(i)),this},provider:p,resetProviders:function(t){var r=this.originalProviders,i=Array.isArray(t);Object.keys(this.originalProviders).forEach((function(n){if(!i||-1!==t.indexOf(n)){var o=n.split(e);o.length>1&&o.forEach(_,l.call(this,o[0])),_.call(this,n),this.provider(n,r[n])}}),this)},register:O,resolve:function(t){return this.deferred.forEach((function(e){e(t)})),this},service:function(t,e){return g.apply(this,[t,e,!0].concat(a.call(arguments,2)))},serviceFactory:function(t,e){return g.apply(this,[t,e,!1].concat(a.call(arguments,2)))},value:function(t,r){var i;return i=t.split(e),t=i.pop(),y.call(i.reduce(b,this.container),t,r),this}},t.pop=function(e){var r;return typeof e===i?((r=$[e])||($[e]=r=new t,r.constant("BOTTLE_NAME",e)),r):new t},t.clear=function(t){typeof t===i?delete $[t]:$={}},t.list=P,t.config={strict:!1};var E=t;class A{static BASE_URL="";constructor(){this.meta={},this.server=A.BASE_URL,this.logChain=Promise.resolve()}init({respondentId:t,surveyCode:e}){t&&(this.meta.uid=t.toString(),this.meta.survey=e)}log(t){if(!this.meta.uid)return;const e=t&&t.message&&t||{message:t};e.time=Date.now(),console.log(e),this.logChain=this.logChain.then(this.sendLogs(e))}sendLogs(t){return fetch(this.server,{method:"POST",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({...this.meta,data:JSON.stringify(t)})})}}const S=new E;return function({logUrl:t}={}){if(!t)throw new Error("logUrl is required");return((t,e)=>{A.BASE_URL=e,t.service("logService",A)})(S,t),S.container}}();
