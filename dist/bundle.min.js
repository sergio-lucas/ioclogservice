!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ioc=e()}(this,(function(){"use strict";var t,e=".",i="function",r="string",n="__global__",o="Provider",s=0,a=Array.prototype.slice,c=function(e,i){var r=e[i];if(void 0===r&&t.config.strict)throw new Error("Bottle was unable to resolve a service.  `"+i+"` is undefined.");return r},l=function(e){var i;return this.nested[e]||(i=t.pop(),this.nested[e]=i,this.factory(e,(function(){return i.container}))),this.nested[e]},u=function(t){return t.split(e).reduce(c,this)},h=function(t,e){return e(t)},d=function(t,e){return(t[e]||[]).concat(t.__global__||[])},f=function(t,e){var i,r,n,s,a;return this.id,n=this.container,s=this.decorators,a=this.middlewares,i=t+o,(r=Object.create(null))[i]={configurable:!0,enumerable:!0,get:function(){var t=new e;return delete n[i],n[i]=t,t}},r[t]={configurable:!0,enumerable:!0,get:function(){var e,r=n[i];return r&&(e=d(s,t).reduce(h,r.$get(n)),delete n[i],delete n[t]),void 0===e?e:function(t,e,i,r){var n={configurable:!0,enumerable:!0};return t.length?n.get=function(){var e=0,r=function(n){if(n)throw n;t[e]&&t[e++](i,r)};return r(),i}:(n.value=i,n.writable=!0),Object.defineProperty(r,e,n),r[e]}(d(a,t),t,e,n)}},Object.defineProperties(n,r),this},p=function(t,i){var r,n;return r=t.split(e),this.providerMap[t]&&1===r.length&&!this.container[t+o]?console.error(t+" provider already instantiated."):(this.originalProviders[t]=i,this.providerMap[t]=!0,n=r.shift(),r.length?(l.call(this,n).provider(r.join(e),i),this):f.call(this,n,i))},v=function(t,e){return p.call(this,t,(function(){this.$get=e}))},g=function(t,e,i){var r=arguments.length>3?a.call(arguments,3):[],n=this;return v.call(this,t,(function(){var t=e,o=r.map(u,n.container);return i?new(e.bind.apply(e,[null].concat(o))):t.apply(null,o)}))},y=function(t,e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})},b=function(t,e){var i=t[e];return i||y.call(t,e,i={}),i},m=function(t,e){Object.defineProperty(this,t,{configurable:!1,enumerable:!0,value:e,writable:!1})},w=function(t,r){var o,s;return typeof t===i&&(r=t,t=n),s=(o=t.split(e)).shift(),o.length?l.call(this,s).decorator(o.join(e),r):(this.decorators[s]||(this.decorators[s]=[]),this.decorators[s].push(r)),this},j=function(t){return!/^\$(?:decorator|register|list)$|Provider$/.test(t)},P=function(t){return Object.keys(t||this.container||{}).filter(j)},$={},O=function(t){var e=void 0===t.$value?t:t.$value;return this[t.$type||"service"].apply(this,[t.$name,e].concat(t.$inject||[]))},_=function(t){delete this.providerMap[t],delete this.container[t],delete this.container[t+o]};(t=function t(e){if(!(this instanceof t))return t.pop(e);this.id=s++,this.decorators={},this.middlewares={},this.nested={},this.providerMap={},this.originalProviders={},this.deferred=[],this.container={$decorator:w.bind(this),$register:O.bind(this),$list:P.bind(this)}}).prototype={constant:function(t,i){var r=t.split(e);return t=r.pop(),m.call(r.reduce(b,this.container),t,i),this},decorator:w,defer:function(t){return this.deferred.push(t),this},digest:function(t){return(t||[]).map(u,this.container)},factory:v,instanceFactory:function(t,e){return v.call(this,t,(function(t){return{instance:e.bind(e,t)}}))},list:P,middleware:function(t,r){var o,s;return typeof t===i&&(r=t,t=n),s=(o=t.split(e)).shift(),o.length?l.call(this,s).middleware(o.join(e),r):(this.middlewares[s]||(this.middlewares[s]=[]),this.middlewares[s].push(r)),this},provider:p,resetProviders:function(t){var i=this.originalProviders,r=Array.isArray(t);Object.keys(this.originalProviders).forEach((function(n){if(!r||-1!==t.indexOf(n)){var o=n.split(e);o.length>1&&o.forEach(_,l.call(this,o[0])),_.call(this,n),this.provider(n,i[n])}}),this)},register:O,resolve:function(t){return this.deferred.forEach((function(e){e(t)})),this},service:function(t,e){return g.apply(this,[t,e,!0].concat(a.call(arguments,2)))},serviceFactory:function(t,e){return g.apply(this,[t,e,!1].concat(a.call(arguments,2)))},value:function(t,i){var r;return r=t.split(e),t=r.pop(),y.call(r.reduce(b,this.container),t,i),this}},t.pop=function(e){var i;return typeof e===r?((i=$[e])||($[e]=i=new t,i.constant("BOTTLE_NAME",e)),i):new t},t.clear=function(t){typeof t===r?delete $[t]:$={}},t.list=P,t.config={strict:!1};var E=t;class A{static BASE_URL="";constructor(){this.meta={},this.server=A.BASE_URL,this.logChain=Promise.resolve()}init({respondentId:t,surveyCode:e}){t&&(this.meta.uid=t.toString(),this.meta.survey=e)}log(t){if(!this.meta.uid)return;const e=t&&t.message&&t||{message:t};e.time=Date.now(),console.log(e),this.logChain=this.logChain.then(this.sendLogs(e))}sendLogs(t){return fetch(this.server,{method:"POST",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({...this.meta,data:JSON.stringify(t)})})}}const S=new E;return function({logUrl:t}={}){if(!t)throw new Error("logUrl is required");var e,i;return e=S,i=t,A.BASE_URL=i,e.service("logService",A),S.container}}));
